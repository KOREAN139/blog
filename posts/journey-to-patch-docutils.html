<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Â¯\_(ãƒ„)_/Â¯ | Journey to patch docutils</title>
  <meta name="description" content="Nekoyume to sphinx, sphinx to docutils">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Journey to patch docutils">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://korean139.github.io/blog/blog/posts/journey-to-patch-docutils">
  <meta property="og:description" content="Nekoyume to sphinx, sphinx to docutils">
  <meta property="og:site_name" content="Â¯\_(ãƒ„)_/Â¯">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://korean139.github.io/blog/blog/posts/journey-to-patch-docutils">
  <meta name="twitter:title" content="Journey to patch docutils">
  <meta name="twitter:description" content="Nekoyume to sphinx, sphinx to docutils">

  
    <meta property="og:image" content="https://korean139.github.io/blog/blog/assets/og-image-ee46bbc61b334e821e81534b1fd43f3fee6f020ec174b3c2114445695fd48c01.jpg">
    <meta name="twitter:image" content="https://korean139.github.io/blog/blog/assets/og-image-ee46bbc61b334e821e81534b1fd43f3fee6f020ec174b3c2114445695fd48c01.jpg">
  

  <link href="https://korean139.github.io/blog/blog/feed.xml" type="application/rss+xml" rel="alternate" title="Â¯\_(ãƒ„)_/Â¯ Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/blog/assets/favicon-light-b2f0a117583b90491f77c3b1f29c3030cd62f6ba10bd1fff1df9877f3c6905f8.ico">
      <link rel="apple-touch-icon" href="/blog/assets/apple-touch-icon-light-c4623f519acdf6c6ebdbe25aa71edb29387ab74c9878042fdf16b48a00d415b5.png">
      <link rel="stylesheet" type="text/css" title="light" id="light" href="/blog/assets/light-2ed07da67517b629467203ab75e012eec702ac0f653011a63c47a3b30fe6b319.css">
      <link rel="stylesheet" type="text/css" title="dark" id="dark" href="/blog/assets/dark-7519a6a591b2012a23f61ae5b0fd4b9b467e2a3cc20ea6fa3866a6af51c7ef61.css" disabled="true">
    

  

</head>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    TeX: {
      equationNumbers: {
        autoNumber: "AMS"
      }
    },
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(', '\\)'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true,
    }
  });
</script>
<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/blog/" class="header-logo" title="Â¯\_(ãƒ„)_/Â¯">Â¯\_(ãƒ„)_/Â¯</a>
  <ul class="header-links">
    
    
    
    
    
      <li>
        <a href="https://github.com/KOREAN139" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/blog/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github" xlink:href="/blog/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/sangguhan" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
  <use href="/blog/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin" xlink:href="/blog/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://instagram.com/nerdipapi" rel="noreferrer noopener" target="_blank" title="Instagram">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-instagram">
  <use href="/blog/assets/instagram-37f85bc75b43ecc4c114d9a46f846327fe13c5893787c6afbcfef9d30d58bd9e.svg#icon-instagram" xlink:href="/blog/assets/instagram-37f85bc75b43ecc4c114d9a46f846327fe13c5893787c6afbcfef9d30d58bd9e.svg#icon-instagram"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:korean139@gmail.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/blog/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email" xlink:href="/blog/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
    
      <li>
        <a onclick="toggle()" title="Toggle Theme">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-theme">
  <use href="/blog/assets/theme-66869e0bf8dab34bae1c86bda400327b772e0be69e8dc28d3ede896e771320ed.svg#icon-theme" xlink:href="/blog/assets/theme-66869e0bf8dab34bae1c86bda400327b772e0be69e8dc28d3ede896e771320ed.svg#icon-theme"></use>
</svg>

        </a>
      </li>
    
  </ul>
</nav>



        <article class="article scrollappear">
          <header class="article-header">
            <h1>Journey to patch docutils</h1>
            <p>Nekoyume to sphinx, sphinx to docutils</p>
            <div class="article-list-footer">
  <span class="article-list-date">
    August 19, 2018
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      6 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
      
      <a href="/blog/tag/opensource" title="See all posts with tag 'opensource'">opensource</a>
    
      
      <a href="/blog/tag/contribution" title="See all posts with tag 'contribution'">contribution</a>
    
      
      <a href="/blog/tag/nekoyume" title="See all posts with tag 'nekoyume'">nekoyume</a>
    
      
      <a href="/blog/tag/sphinx" title="See all posts with tag 'sphinx'">sphinx</a>
    
      
      <a href="/blog/tag/docutils" title="See all posts with tag 'docutils'">docutils</a>
    
  </div>
</div>
          </header>

          <div class="article-content">
            <p><a href="https://www.pycon.kr/2018/">PYCON KOREA 2018</a>ì˜ ì»¨í¼ëŸ°ìŠ¤ ì¼ì •ì„ êµ¬ê²½í•˜ë˜ ì¤‘, <a href="https://nekoyu.me">nekoyume</a>ë¼ëŠ” í”„ë¡œì íŠ¸ë¥¼ ë°œê²¬í–ˆë‹¤.
ë¸”ë¡ì²´ì¸ + RPGë¼ë‹ˆ, ê·¸ëƒ¥ ì§€ë‚˜ì¹˜ê¸° ì–´ë ¤ìš´ ì¡°í•©ì´ì§€ ì•Šì€ê°€!</p>

<p>í”Œë ˆì´ ì»¨ì…‰ê³¼ í”„ë¡œì íŠ¸ êµ¬í˜„ì„ ìœ„í•´ ì‚¬ìš©í•œ ê¸°ìˆ  ë“± ì •ë³´ë¥¼ ì–»ê¸° ìœ„í•´ <a href="https://docs.nekoyu.me/white_paper_ko.html">nekoyume ë°±ì„œ</a>ë¥¼ ì½ê¸° ì‹œì‘í–ˆë‹¤.</p>

<h1 id="missing-herf-links"><strong>Missing herf links</strong></h1>
<p>ë°±ì„œë¥¼ í›‘ì–´ë³´ë˜ ì¤‘, ì‚¬ì´ë“œë°”ì˜ ë§í¬ê°€ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•ŠëŠ” ì´ìŠˆê°€ ë°œìƒí–ˆë‹¤. ì›ì¸ì„ í™•ì¸í•˜ê¸° ìœ„í•´ HTML ì†ŒìŠ¤ë¥¼ í›‘ì–´ë´¤ëŠ”ë°, <code class="highlighter-rouge">href="#"</code>ì™€ ê°™ì´ <em>internal link</em>ê°€ ì œëŒ€ë¡œ ë§í¬ë˜ì–´ìˆì§€ ì•ŠìŒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.</p>

<p>ì™œ ì´ìŠˆê°€ ë°œìƒí•˜ëŠ”ì§€ root causeë¥¼ ì°¾ê¸° ìœ„í•´ ë” í›‘ì–´ë³¸ ê²°ê³¼, ëª‡ ê°€ì§€ ê·œì¹™ì„ ì°¾ì„ ìˆ˜ ìˆì—ˆë‹¤.</p>

<p><a id="rules"></a></p>
<ol>
  <li>ëª¨ë“  heading tagëŠ” wrapping divê°€ ìˆë‹¤.</li>
  <li>wrapping <strong>divì˜ idëŠ” heading tag ë‚´ë¶€ì˜ textì™€ ë™ì¼</strong>í•˜ë‹¤. <br />(ë‹¨, text ë‚´ì˜ ê³µë°±ì€ <code class="highlighter-rouge">-</code>(dash)ë¡œ ëŒ€ì²´ëœë‹¤.)</li>
  <li><strong>(ì•„ë§ˆë„) ascii character, ê·¸ì¤‘ì—ì„œë„ <code class="highlighter-rouge">[a-z0-9]</code>, ë§Œ idë¡œ ë“±ë¡ëœë‹¤.</strong> <br />ì¦‰, <strong>non-ascii characterëŠ” ëª¨ë‘ drop</strong>ëœë‹¤.</li>
  <li>ì‚¬ì´ë“œë°”ì˜ <em>internal link</em>ëŠ” wrapping divì˜ idë¥¼ ì´ìš©í•œë‹¤.</li>
</ol>

<p>heading tag ë‚´ë¶€ì˜ textì— <code class="highlighter-rouge">[a-z0-9]</code>ê°€ í•œ ê¸€ìë„ ì—†ì„ ì‹œ <code class="highlighter-rouge">&lt;div class="section" id=""&gt;</code>ì™€ ê°™ì´ idê°€Â Â»ë¹ˆ ë¬¸ìì—´Â«ì´ì˜€ê³ , ì´ ê²½ìš° <code class="highlighter-rouge">href="#"</code>ì™€ ê°™ì´ <em>internal link</em>ê°€ ì œëŒ€ë¡œ ë§í¬ë˜ì§€ ì•Šì€ ê²ƒì´ì—ˆë‹¤.</p>

<h1 id="solve-the-issue"><strong>Solve the issue</strong></h1>
<p>ìœ„ì˜ ê·œì¹™ì„ ì°¾ê³  ë‚˜ì„œ, í•œ ê°€ì§€ ì•„ì´ë””ì–´ë¥¼ ë– ì˜¬ë¦´ ìˆ˜ ìˆì—ˆë‹¤.</p>

<p>2ë²ˆ ê·œì¹™ì„ ë‹¤ì‹œ ë§í•˜ë©´, heading tag ë‚´ë¶€ì— <code class="highlighter-rouge">[a-z0-9]</code>ë¥¼ ë§Œì¡±í•˜ëŠ” ê¸€ìê°€ í•˜ë‚˜ë¼ë„ ì¡´ì¬í•  ì‹œ idê°€ ìƒì„±ëœë‹¤ê³  ë§í•  ìˆ˜ ìˆë‹¤. ì¦‰, <strong>heading tag ë‚´ë¶€ì— ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ascii characterë¥¼ í¬í•¨í•˜ëŠ” commentë¥¼ ì‘ì„±</strong>í•˜ë©´ ìœ„ ì´ìŠˆë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤!</p>

<p>ë‹¨, <code class="highlighter-rouge">.md</code>, <code class="highlighter-rouge">.html</code> ë‘ íŒŒì¼ í¬ë§·ì—ì„œ comment í˜•ì‹ì„ ë§Œì¡±ì‹œì¼œì•¼ í•˜ê¸° ë•Œë¬¸ì— <code class="highlighter-rouge">&lt;!-- --&gt;</code> ìŠ¤íƒ€ì¼ì„ ì´ìš©í•´ì•¼ í•œë‹¤.</p>

<p>ìœ„ ì•„ì´ë””ì–´ë¥¼ ì´ìš©í•´ <a href="https://github.com/nekoyume/nekoyume/pull/92">PR</a>ì„ ë³´ëƒˆê³ , nekoyume:masterì— mergeë˜ì–´ ë³¸ ì´ìŠˆëŠ” í•´ê²°ëœ ìƒíƒœì´ë‹¤. (ì•„ì§ nekoyume:gh-pagesê°€ ì—…ë°ì´íŠ¸ë˜ì§€ ì•Šì€ ê²ƒìœ¼ë¡œ ë³´ì•„ mergeì´í›„ deployëŠ” ì§„í–‰í•˜ì§€ ì•Šì€ ê²ƒ ê°™ë‹¤.)</p>

<h1 id="journey-to-resolve-the-issue"><strong>Journey to resolve the issue</strong></h1>
<p>í•˜ì§€ë§Œ ì–´ë–»ê²Œ ì´ìŠˆë¥¼ ê·¼ë³¸ì ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìˆì„ì§€ ê³ ë¯¼í•´ë³´ê¸° ìœ„í•´ì„œ, ë°±ì„œê°€ ë¹Œë“œë˜ëŠ” ê³¼ì •ì„ í•˜ë‚˜í•˜ë‚˜ ì«“ì•„ê°€ë©° ëª¨ë“  ê³¼ì •ì„ ì˜ì‹¬í•´ë³´ê¸°ë¡œ í–ˆë‹¤.</p>

<h2 id="environment">environment</h2>
<p>ë°±ì„œì˜ ë‚´ìš©ì€ markdownì„ í†µí•´ ì‘ì„±ë˜ì—ˆê³ , <a href="https://github.com/sphinx-doc/sphinx">sphinx</a>ë¥¼ í†µí•´ ìë™ìœ¼ë¡œ ë¹Œë“œí•˜ê³  ìˆì—ˆë‹¤. markdown-basedì˜€ê¸° ë•Œë¬¸ì— sphinx ë‚´ë¶€ ë¹Œë“œ ê³¼ì •ì—ì„œ <a href="https://recommonmark.readthedocs.io/en/latest/index.html">recommonmark</a>ì˜ CommonMarkParserë¥¼ ì´ìš©í•´ markdownì„ parsingí•˜ê³  ìˆì—ˆë‹¤.</p>

<h2 id="recommonmark"><a href="https://recommonmark.readthedocs.io/en/latest/index.html">recommonmark</a></h2>
<p>ì²˜ìŒìœ¼ë¡œ ì˜ì‹¬í–ˆë˜ ê±´Â Â»<em>markdown parsing ê³¼ì •ì—ì„œ non-ascii characterì˜ ëˆ„ë½ ê°€ëŠ¥ì„±</em>Â«Â ì´ì—ˆë‹¤.
 í•˜ì§€ë§Œ ì •ìƒì ìœ¼ë¡œ parsing ì´í›„ì—ë„ heading textê°€ ìœ ì§€ë˜ëŠ” ê²ƒì„ í™•ì¸í–ˆê³ , recommonmarkëŠ” ê²°ë°±í•œ ì¹œêµ¬ì„ì„ ì•Œì•„ëƒˆë‹¤. (parsing ê³¼ì •ì—ì„œëŠ” id, internal linkê°€ ìƒì„±ë˜ì§€ ì•ŠëŠ”ë‹¤)</p>

<h2 id="sphinx"><a href="https://github.com/sphinx-doc/sphinx">sphinx</a></h2>
<p>ë‹¤ìŒìœ¼ë¡œ ì˜ì‹¬í•œ ì¹œêµ¬ëŠ” sphinxì˜€ë‹¤.Â Â»<em>build ê³¼ì •ì—ì„œ non-ascii characterì˜ ëˆ„ë½ ê°€ëŠ¥ì„±</em>Â«ì— ì¤‘ì ì„ ë‘ê³  ì«“ì•„ê°€ë´¤ë‹¤. ë‹¤ìŒ <a href="https://github.com/sphinx-doc/sphinx/blob/004b68f281dbad6e7598c8c2f56945bb3bc07107/sphinx/writers/html.py">ì½”ë“œ</a>ì—ì„œ íŒíŠ¸ë¥¼ ë°œê²¬í•  ìˆ˜ ìˆì—ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"> <span class="k">def</span> <span class="nf">depart_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c1"># type: (nodes.Node) -&gt; None
</span>        <span class="n">close_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">context</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">permalink_text</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="n">add_permalinks</span> <span class="ow">and</span>
           <span class="n">node</span><span class="p">.</span><span class="n">parent</span><span class="p">.</span><span class="nb">hasattr</span><span class="p">(</span><span class="s">'ids'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="p">.</span><span class="n">parent</span><span class="p">[</span><span class="s">'ids'</span><span class="p">]):</span>
            <span class="c1"># add permalink anchor
</span>            <span class="k">if</span> <span class="n">close_tag</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'&lt;/h'</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">add_permalink_ref</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">'Permalink to this headline'</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">close_tag</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'&lt;/a&gt;&lt;/h'</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="sa">u</span><span class="s">'&lt;/a&gt;&lt;a class="headerlink" href="#%s" '</span> <span class="o">%</span>
                                 <span class="n">node</span><span class="p">.</span><span class="n">parent</span><span class="p">[</span><span class="s">'ids'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
                                 <span class="sa">u</span><span class="s">'title="%s"&gt;%s'</span> <span class="o">%</span> <span class="p">(</span>
                                     <span class="n">_</span><span class="p">(</span><span class="s">'Permalink to this headline'</span><span class="p">),</span>
                                     <span class="bp">self</span><span class="p">.</span><span class="n">permalink_text</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">nodes</span><span class="p">.</span><span class="n">table</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'&lt;/span&gt;'</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">add_permalink_ref</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">'Permalink to this table'</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">nodes</span><span class="p">.</span><span class="n">table</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'&lt;/span&gt;'</span><span class="p">)</span></code></pre></figure>

<p><code class="highlighter-rouge">href="#%s"</code>ì—ì„œ <code class="highlighter-rouge">%s</code>ì— ë“¤ì–´ê°€ëŠ” ë¬¸ìì—´ì€ <code class="highlighter-rouge">node.parent['ids']</code>, ì¦‰ <strong>class node â€˜idsâ€™ attribute ê°’</strong>ì´ì—ˆë‹¤!</p>

<p>ì—¬ê¸°ì„œ ì‚¬ìš©ë˜ëŠ” <code class="highlighter-rouge">class node</code>ëŠ” sphinxê°€ ì •ì˜í•œ ê²ƒì´ ì•„ë‹ˆë¼,Â Â»<em>sphinxê°€ ê°€ì ¸ë‹¤ ì“°ê³  ìˆëŠ” ì˜¤í”ˆì†ŒìŠ¤ì¸ <a href="http://docutils.sourceforge.net">docutils</a>ì˜ ìë£Œêµ¬ì¡°</em>Â«ì˜€ê³  â€˜idsâ€™ attributeë˜í•œ docutilsì—ì„œ assigní•˜ê³  ìˆì—ˆë‹¤. sphinx ë˜í•œ ê²°ë°±í•œ ì¹œêµ¬ì˜€ìŒì„ ì•Œì•„ëƒˆë‹¤.</p>

<h2 id="docutils"><a href="http://docutils.sourceforge.net">docutils</a></h2>
<p>ì´ì œ â€˜idsâ€™ attributeê°€ ì–´ë–¤ ê³¼ì •ìœ¼ë¡œ assignë˜ëŠ”ì§€ ëœ¯ì–´ë³¼ ì°¨ë¡€ë‹¤. <code class="highlighter-rouge">class node</code>ê°€ ì •ì˜ëœ <a href="https://sourceforge.net/p/docutils/code/HEAD/tree/trunk/docutils/docutils/nodes.py">ì†ŒìŠ¤ íŒŒì¼</a>ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ commentë¥¼ í™•ì¸ í•  ìˆ˜ ìˆì—ˆë‹¤.</p>

<blockquote>
  <p>There are two special attributes: â€˜idsâ€™ and â€˜namesâ€™.  Both are<br />
    lists of unique identifiers, and names serve as human interfaces<br />
    to IDs.  Names are case- and whitespace-normalized (see the<br />
    fully_normalize_name() function), and IDs conform to the regular<br />
    expression <code class="highlighter-rouge">[a-z](-?[a-z0-9]+)*</code> (see the make_id() function).</p>
</blockquote>

<p><strong><em>ë²”ì¸ì„ ì°¾ì•˜ë‹¤!</em></strong></p>

<p>ìœ„ì—ì„œ ì°¾ì•˜ë˜ <a href="#rules">ê·œì¹™</a>ì´ ì–¼ì¶” ë§ì•˜ë‹¤. case- and whitespace-normalized ì´í›„ regex (<code class="highlighter-rouge">[a-z](-?[a-z0-9]+)*</code>)ì— ë§ëŠ” í˜•ì‹ìœ¼ë¡œ â€˜idsâ€™ attributeë¥¼ assigní•˜ê³  ìˆì—ˆë‹¤.</p>

<p><a href="https://sourceforge.net/p/docutils/code/HEAD/tree/trunk/docutils/docutils/nodes.py#l2093">make_id()</a> í•¨ìˆ˜ë¥¼ ë³´ë©´ ë³´ë‹¤ ëª…í™•í•˜ê²Œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"> <span class="k">def</span> <span class="nf">make_id</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="s">"""
    Convert `string` into an identifier and return it.

    Docutils identifiers will conform to the regular expression
    ``[a-z](-?[a-z0-9]+)*``.  For CSS compatibility, identifiers (the "class"
    and "id" attributes) should have no underscores, colons, or periods.
    Hyphens may be used.

    - The `HTML 4.01 spec`_ defines identifiers based on SGML tokens:

          ID and NAME tokens must begin with a letter ([A-Za-z]) and may be
          followed by any number of letters, digits ([0-9]), hyphens ("-"),
          underscores ("_"), colons (":"), and periods (".").

    - However the `CSS1 spec`_ defines identifiers based on the "name" token,
      a tighter interpretation ("flex" tokenizer notation; "latin1" and
      "escape" 8-bit characters have been replaced with entities)::

          unicode     </span><span class="se">\\</span><span class="s">[0-9a-f]{1,4}
          latin1      [&amp;iexcl;-&amp;yuml;]
          escape      {unicode}|</span><span class="se">\\</span><span class="s">[ -~&amp;iexcl;-&amp;yuml;]
          nmchar      [-a-z0-9]|{latin1}|{escape}
          name        {nmchar}+

    The CSS1 "nmchar" rule does not include underscores ("_"), colons (":"),
    or periods ("."), therefore "class" and "id" attributes should not contain
    these characters. They should be replaced with hyphens ("-"). Combined
    with HTML's requirements (the first character must be a letter; no
    "unicode", "latin1", or "escape" characters), this results in the
    ``[a-z](-?[a-z0-9]+)*`` pattern.

    .. _HTML 4.01 spec: http://www.w3.org/TR/html401
    .. _CSS1 spec: http://www.w3.org/TR/REC-CSS1
    """</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">.</span><span class="n">translate</span><span class="p">(</span><span class="n">_non_id_translate_digraphs</span><span class="p">)</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">.</span><span class="n">translate</span><span class="p">(</span><span class="n">_non_id_translate</span><span class="p">)</span>
    <span class="c1"># get rid of non-ascii characters.
</span>    <span class="c1"># 'ascii' lowercase to prevent problems with turkish locale.
</span>    <span class="nb">id</span> <span class="o">=</span> <span class="n">unicodedata</span><span class="p">.</span><span class="n">normalize</span><span class="p">(</span><span class="s">'NFKD'</span><span class="p">,</span> <span class="nb">id</span><span class="p">).</span>\
         <span class="n">encode</span><span class="p">(</span><span class="s">'ascii'</span><span class="p">,</span> <span class="s">'ignore'</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'ascii'</span><span class="p">)</span>
    <span class="c1"># shrink runs of whitespace and replace by hyphen
</span>    <span class="nb">id</span> <span class="o">=</span> <span class="n">_non_id_chars</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="s">'-'</span><span class="p">,</span> <span class="s">' '</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">id</span><span class="p">.</span><span class="n">split</span><span class="p">()))</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">_non_id_at_ends</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
 </code></pre></figure>

<p>commentì—ì„œ <code class="highlighter-rouge">HTML 4.01 spec</code>ì—ì„œ ì •ì˜í•œ identifier í˜•ì‹ì„ ë§Œì¡±ì‹œí‚¤ê¸° ìœ„í•´ ì´ëŸ° ê³¼ì •ì„ ê±°ì³ì•¼ í•¨ì„ ê°„ëµí•˜ê²Œ ì„¤ëª…í•´ì¤€ë‹¤.</p>

<p>ê·¸ëŸ¼ <code class="highlighter-rouge">[a-z](-?[a-z0-9]+)*</code> íŒ¨í„´ì„ ë§Œì¡±í•˜ì§€ ëª»í•˜ëŠ” ê²½ìš°ëŠ” ì“¸ì“¸íˆ empty identifierë¥¼ ë¶€ì—¬ë°›ê³  í‰ìƒ anonymousë¡œ ì‚´ì•„ê°€ì•¼ í• ê¹Œ? ğŸ˜¢</p>

<h2 id="unicode-string-to-byte-stream">Unicode string to byte stream</h2>
<p>ascii characterë¥¼ 1byte(<code class="highlighter-rouge">0x00~0x7F</code>)ë¡œ í‘œí˜„í•  ìˆ˜ ìˆëŠ” ê²ƒì²˜ëŸ¼, unicode ë˜í•œÂ Â»<em>16ì§„ìˆ˜ë¡œ ì´ë£¨ì–´ì§„ byte stream</em>Â«ìœ¼ë¡œ í‘œí˜„í•  ìˆ˜ ìˆë‹¤. (ex. <code class="highlighter-rouge">í˜í¼ë¡œë‹ˆ</code> to <code class="highlighter-rouge">0xD3980xD37C0xB85C0xB2C8</code>)</p>

<p><strong><em>â€œê·¸ë ‡ë‹¤ë©´ unicode byte streamì„ stringìœ¼ë¡œ ë– ì„œ indentifierë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ?â€</em></strong></p>

<p>python2ì—ì„œ unicodeì˜ byte streamì„ stringìœ¼ë¡œ ë§Œë“œëŠ” ê±´ ê°„ë‹¨í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"> <span class="n">byte_stream_str</span> <span class="o">=</span> <span class="s">""</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">unicode_string</span><span class="p">))</span>
 </code></pre></figure>

<p>unicode ë¬¸ìì—´ ê° ê¸€ìë¥¼ 16ì§„ìˆ˜ë¡œ ë‚˜íƒ€ë‚¸ ë‹¤ìŒ, ì „ë¶€ ì´ì–´ë¶™ì´ë©´ ëœë‹¤. (ìœ„ ì½”ë“œ)</p>

<p>ì´ë ‡ê²Œ ë§Œë“¤ì–´ë‚¸ ë¬¸ìì—´ì„ ë°”ë¡œ identifierë¡œ ì‚¬ìš©í•˜ê³  ì‹¶ì§€ë§Œ, <code class="highlighter-rouge">(0x[0-9a-f])+</code> ê¼´ì´ê¸° ë•Œë¬¸ì— <code class="highlighter-rouge">HTML 4.01 spec</code>ì—ì„œ ì •ì˜í•œ identifier í˜•ì‹ <code class="highlighter-rouge">must begin with a letter ([A-Za-z])</code>ë¥¼ ë§Œì¡±ì‹œí‚¤ê¸° ìœ„í•´ì„  ë¬¸ìì—´ì˜ ì²« ë¶€ë¶„ì„ ì•ŒíŒŒë²³ìœ¼ë¡œ ë°”ê¿”ì¤˜ì•¼ í•œë‹¤.</p>

<p>íŒ¨ì¹˜ ì‘ì„±ì‹œì— <code class="highlighter-rouge">.replace('0x', 'u')</code>ë¥¼ ì¶”ê°€í•´ <code class="highlighter-rouge">0x</code>ë¥¼ <code class="highlighter-rouge">u</code>ë¡œ ë°”ê¾¸ëŠ” ë°©ì‹ì„ ì ìš©í–ˆìœ¼ë‚˜ (ìµœì¢… ë¬¸ìì—´ì€ <code class="highlighter-rouge">(u[0-9a-f])+</code>ê¼´ì´ ëœë‹¤), ë¬¸ìì—´ì˜ ì²« ê¸€ìë¥¼ ì•ŒíŒŒë²³ìœ¼ë¡œ ë°”ê¾¸ê±°ë‚˜, ì•ŒíŒŒë²³ì„ ë¬¸ìì—´ì˜ ì²« ë¶€ë¶„ì— ì‚½ì…í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì§„í–‰í•´ë„ ê´œì°®ë‹¤.</p>

<h2 id="patch"><a href="https://sourceforge.net/p/docutils/patches/143/">Patch</a></h2>
<p>make_id() ë‚´ë¶€ì—ì„œ <strong>non-ascii characterë¥¼ ì „ë¶€ ì œê±°í•œ ë’¤, ë¹ˆ ë¬¸ìì—´ë§Œ ë‚¨ê²Œ ë˜ëŠ” ê²½ìš°</strong> ìœ„ ì½”ë“œë¥¼ í†µí•´ <strong>byte streamì„ identifierë¡œ return</strong>í•˜ë„ë¡ ìˆ˜ì •í•˜ì—¬ íŒ¨ì¹˜ë¥¼ ì œì¶œí–ˆë‹¤. (<a href="https://github.com/KOREAN139/docutils_patch_143/blob/master/make_id.patch">ì œì¶œí•œ íŒ¨ì¹˜</a>)</p>

<h1 id="finishing-the-journey"><strong>Finishing the journey</strong></h1>
<p>nekoyume í”„ë¡œì íŠ¸ êµ¬ê²½ì—ì„œ ìƒ›ê¸¸ë¡œ ë¹ ì ¸ docutilsì— patch submitì„ í•˜ê¸°ê¹Œì§€ì˜ (â€¦) ì—¬ì •ì„ ê°„ëµí•˜ê²Œ ì •ë¦¬í•´ë´¤ë‹¤. ì‘ì€ ì´ìŠˆì˜ ì›ì¸ì„ ì°¾ì•„ ê±°ê¾¸ë¡œ ì˜¬ë¼ê°€ë©° ì—¬ëŸ¬ í”„ë¡œì íŠ¸ì˜ ì†ŒìŠ¤ë¥¼ ë¶„ì„í•˜ê³ , ê° ê³¼ì •ì—ì„œ ì˜ì‹¬ì ì„ ìƒê°í•˜ê³ , ê·¸ ì˜ì‹¬ì ì„ í•´ê²°í•´ ë‚˜ê°€ë©´ì„œ root causeë¥¼ ì°¾ì•„ë‚´ê³ , ìµœì¢…ì ìœ¼ë¡œ ì–´ë–»ê²Œ ì´ìŠˆë¥¼ í•´ê²°í• ì§€ ì•„ì´ë””ì–´ë¥¼ ê³ ì•ˆí•´ë‚´ëŠ” ê³¼ì •ì´ êµ‰ì¥íˆ ì¬ë°Œì—ˆë‹¤.</p>

<p>ì œì¶œí•œ íŒ¨ì¹˜ê°€ (approve, decline) ì¤‘ ì–´ëŠ ì„ íƒì„ ë°›ê²Œ ë  ì§€ ëª¨ë¥´ê² ì§€ë§Œ, ì•„ë§ˆ approve ë˜ë”ë¼ë„ docutilsê°€ relaseë¥¼ ìì£¼ í•˜ì§€ ì•ŠëŠ” ì˜¤í”ˆì†ŒìŠ¤ê¸° ë•Œë¬¸ì— í˜„ì¬ docutilsë¥¼ ì‚¬ìš©í•˜ëŠ” ë‹¤ë¥¸ ì˜¤í”ˆì†ŒìŠ¤ì— ì ìš©ë˜ê¸°ê¹Œì§€ëŠ” ì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦¬ì§€ ì•Šì„ê¹Œ ì‹¶ë‹¤.</p>

          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Journey+to+patch+docutils%20-%20https://korean139.github.io/blog/blog/posts/journey-to-patch-docutils" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://korean139.github.io/blog/blog/posts/journey-to-patch-docutils" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
          </div>

          <!-- using utterances for comment -->
          <script src="https://utteranc.es/client.js"
                  repo="korean139/blog"
                  issue-term="url"
                  crossorigin="anonymous"
                  async>
          </script>
        </article>
        <footer class="footer scrollappear">
  <p>
  <!--<a href="/blog/about" title="About me">í•œìƒêµ¬</a>-->
  Maintained by <a href="https://korean139.github.io">í•œìƒêµ¬</a>
  </p>
</footer>

      </div>
    </div>
  </main>
  

<script type="text/javascript" src="/blog/assets/vendor-3ee2c63bbac916f96cd7f90e83ab767f058ead1301444c9966f5156911c8be7f.js"></script>


  <script type="text/javascript" src="/blog/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js"></script>



  <script type="text/javascript" src="/blog/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js"></script>


<script type="text/javascript" src="/blog/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js"></script>


  <script type="text/javascript" src="/blog/assets/themetoggle-df0d3d73164dc26dffbd630182ae4d0dfa7bee6b694a2b5d565d73595b582bbf.js"></script>

</body>
</html>
